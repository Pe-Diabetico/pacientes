<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Visualizador Lúdico — Avaliação de Risco do Pé Diabético</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#6ee7b7;--muted:#9aa4b2;--glass:rgba(255,255,255,0.04);--glass-2:rgba(255,255,255,0.02)}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
    html,body{height:100%;margin:0;background:radial-gradient(1200px 600px at 10% 10%,#071226 0%, transparent 15%),linear-gradient(180deg,#071028 0%, #081322 50%, #06101e 100%);color:#e6eef6}
    .wrap{max-width:1150px;margin:36px auto;padding:28px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 8px 40px rgba(2,6,23,0.7);}
    header{display:flex;gap:16px;align-items:center}
    .logo{width:72px;height:72px;border-radius:14px;background:linear-gradient(120deg,var(--accent),#60a5fa);display:grid;place-items:center;font-weight:700;color:#06202a}
    h1{font-size:20px;margin:0}
    p.lead{margin:6px 0 18px;color:var(--muted)}

    .grid{display:grid;grid-template-columns:380px 1fr;gap:20px}

    /* painel esquerdo: controles e paciente */
    .panel{background:linear-gradient(180deg,var(--glass),var(--glass-2));padding:18px;border-radius:12px}
    .section-title{font-size:13px;color:var(--muted);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:8px}
    .patient-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:10px;display:flex;gap:12px;align-items:center}
    .avatar{width:72px;height:72px;border-radius:12px;background:linear-gradient(135deg,#2b3b4f,#1b2a3a);display:grid;place-items:center;font-weight:700;font-size:18px;color:#9bded5}
    .meta{flex:1}
    .meta div{font-size:14px}
    .meta small{color:var(--muted);display:block}

    .controls{margin-top:12px;display:grid;gap:10px}
    .btn{background:linear-gradient(90deg,#6ee7b7,#60a5fa);border:none;padding:10px 12px;border-radius:10px;font-weight:700;color:#052023;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--accent)}

    .toggle-row{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:8px 10px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:13px}

    /* painel direito: visualizações */
    .canvas{display:grid;grid-template-rows:120px 1fr;gap:14px}
    .summary{display:flex;gap:14px;align-items:center}
    .risk-meter{flex:1;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:10px;display:flex;flex-direction:column;gap:8px}
    .meter{height:16px;background:rgba(255,255,255,0.03);border-radius:999px;overflow:hidden}
    .meter-fill{height:100%;width:0%;background:linear-gradient(90deg,#f97316,#ef4444);transition:width 900ms cubic-bezier(.2,.9,.3,1)}
    .risk-score{font-size:28px;font-weight:800}
    .badges{display:flex;gap:8px;align-items:center}
    .badge{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);font-weight:600}

    /* cards area */
    .cards{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:12px;min-height:140px}
    .card h3{margin:0 0 8px 0;font-size:14px}
    .feature-list{display:grid;gap:6px}
    .feature{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:rgba(255,255,255,0.01)}
    .muted{color:var(--muted);font-size:13px}

    /* footer / references */
    footer{margin-top:18px;padding:14px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
    .refs{font-size:13px;color:var(--muted);line-height:1.5}

    /* small responsive */
    @media (max-width:980px){.grid{grid-template-columns:1fr;}.cards{grid-template-columns:1fr}}

    /* playful accents */
    .sparkles{position:absolute;right:36px;top:24px;opacity:0.08;font-size:120px;transform:rotate(-20deg)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="sparkles">✦✦</div>
    <header>
      <div class="logo">PD</div>
      <div>
        <h1>Explorador Lúdico — Avaliação de Risco do Pé Diabético</h1>
        <p class="lead">Interaja com as características clínicas, biomecânicas e térmicas para ver como o risco de úlcera é calculado. Ideal para apresentações, educação e prototipação de modelos.</p>
      </div>
    </header>

    <div class="grid" style="margin-top:20px">
      <aside class="panel">
        <div class="section-title">Paciente (simulado)</div>
        <div class="patient-card">
          <div class="avatar" id="avatar">CP</div>
          <div class="meta">
            <div id="p_nome">Nome: —</div>
            <small id="p_demo">idade — • sexo — • imc —</small>
            <small id="p_clin">Tempo DM — • HbA1c —</small>
          </div>
        </div>

        <div class="controls">
          <div style="display:flex;gap:8px">
            <button class="btn" id="gerar">Gerar paciente</button>
            <button class="btn secondary" id="reset">Reset</button>
          </div>

          <div class="section-title" style="margin-top:6px">Etiologia & histórico</div>
          <div class="toggle-row" id="etiologia"></div>

          <div class="section-title" style="margin-top:8px">Estilo de vida</div>
          <div class="toggle-row" id="habitos"></div>

          <div class="section-title" style="margin-top:8px">Sensor — gait & plantar</div>
          <div class="toggle-row" id="sensors"></div>

        </div>
      </aside>

      <main class="canvas">
        <div class="summary">
          <div class="risk-meter">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div class="section-title">Risco estimado de úlcera</div>
                <div class="risk-score" id="score">—</div>
                <div class="muted">Classificação: <span id="score-label">—</span></div>
              </div>
              <div class="badges">
                <div class="badge" id="badge-neuro">Neuropatia: —</div>
                <div class="badge" id="badge-dap">DAP: —</div>
              </div>
            </div>
            <div class="meter"><div class="meter-fill" id="meter-fill"></div></div>
          </div>

          <div style="width:340px;display:flex;flex-direction:column;gap:8px">
            <div class="card">
              <h3>Temperatura plantar</h3>
              <div style="display:flex;gap:10px;align-items:center">
                <div style="flex:1">
                  <div class="muted">Esquerdo: <strong id="temp-esq">—</strong> °C</div>
                  <div class="muted">Direito: <strong id="temp-dir">—</strong> °C</div>
                </div>
                <div style="width:80px;text-align:center">
                  <div class="muted">Assimetria</div>
                  <div style="font-weight:800;font-size:20px" id="temp-ass">—</div>
                </div>
              </div>
            </div>

            <div class="card">
              <h3>Pressão Plantar (PPP)</h3>
              <div class="muted">Esq: <strong id="ppp-esq">—</strong> kPa • Dir: <strong id="ppp-dir">—</strong> kPa</div>
              <div style="height:8px;margin-top:8px;background:rgba(255,255,255,0.02);border-radius:6px;overflow:hidden">
                <div id="ppp-bar" style="height:100%;width:0%;background:linear-gradient(90deg,#60a5fa,#f97316)"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="cards">
          <div class="card">
            <h3>Características demográficas & clínicas</h3>
            <div class="feature-list">
              <div class="feature"><div>idade</div><div id="f_idade">—</div></div>
              <div class="feature"><div>sexo</div><div id="f_sexo">—</div></div>
              <div class="feature"><div>imc</div><div id="f_imc">—</div></div>
              <div class="feature"><div>tempo_diabetes_anos</div><div id="f_tempo">—</div></div>
              <div class="feature"><div>hba1c_perc</div><div id="f_hba1c">—</div></div>
            </div>
          </div>

          <div class="card">
            <h3>Biomecânica & marcha</h3>
            <div class="feature-list">
              <div class="feature"><div>velocidade_marcha_m_s</div><div id="f_vel">—</div></div>
              <div class="feature"><div>contagem_passos</div><div id="f_passos">—</div></div>
              <div class="feature"><div>aceleracao_vertical_rms</div><div id="f_acc">—</div></div>
              <div class="feature"><div>orientacao_pe_graus</div><div id="f_ori">—</div></div>
              <div class="feature"><div>deformidade_s_n</div><div id="f_defo">—</div></div>
            </div>
          </div>

          <div class="card">
            <h3>Comorbidades & hábitos</h3>
            <div class="feature-list">
              <div class="feature"><div>has_s_n</div><div id="f_has">—</div></div>
              <div class="feature"><div>tabagismo_s_n</div><div id="f_tab">—</div></div>
              <div class="feature"><div>alcool_s_n</div><div id="f_alc">—</div></div>
              <div class="feature"><div>atividade_fisica_s_n</div><div id="f_atividade">—</div></div>
            </div>
          </div>

          <div class="card">
            <h3>Histórico de lesões</h3>
            <div class="feature-list">
              <div class="feature"><div>ulcera_previa_s_n</div><div id="f_ulc">—</div></div>
              <div class="feature"><div>amputacao_previa_s_n</div><div id="f_amp">—</div></div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <footer>
      <div class="refs">
        <strong>Referências (citadas no conteúdo):</strong>
        <ul>
          <li>Chauhan et al., 2023</li>
          <li>Khandakar et al., 2022</li>
          <li>Tavares et al., 2016</li>
          <li>Ferreira, 2017</li>
          <li>Castillo-Morquecho et al., 2024</li>
          <li>Casadei et al., 2021 (citado em Castillo-Morquecho et al., 2024)</li>
          <li>Borges, 2023</li>
          <li>Chen et al., 2021</li>
          <li>Razak et al., 2012</li>
          <li>Castro-Martins, 2024</li>
          <li>Lourenço, 2018</li>
          <li>Everett et al., 2022</li>
          <li>Kosaji et al., 2025</li>
          <li>Huang et al., 2024</li>
        </ul>
        <div style="margin-top:8px" class="muted">Observação: referências apresentadas conforme solicitado — são listadas para fins educacionais. Para citações formais, consulte os artigos originais.</div>
      </div>
    </footer>
  </div>

  <script>
    // --- dados de configuração (pesos simples para demo) ---
    const WEIGHTS = {
      tempo_diabetes: 0.12,
      hba1c: 0.12,
      neuropatia: 0.22,
      dap: 0.15,
      ppp: 0.12,
      ptt: 0.06,
      temp_ass: 0.14,
      historico_ulc: 0.12
    };

    const state = {
      paciente: null
    };

    function norm(x,min,max){return Math.min(1,Math.max(0,(x-min)/(max-min)))}

    function gerarPaciente(){
      // simula valores plausíveis
      const nome = ['João','Maria','Carlos','Ana','Lúcia','Pedro','Sofia'][Math.floor(Math.random()*7)];
      const sobrenome = ['Silva','Oliveira','Souza','Pereira','Costa','Almeida'][Math.floor(Math.random()*6)];
      const idade = Math.floor(40 + Math.random()*45); // 40-85
      const sexo = Math.random()>0.5? 'M':'F';
      const imc = +(18 + Math.random()*14).toFixed(1); // 18-32
      const tempo = Math.floor(Math.random()*20); // 0-20 anos
      const hba1c = +(5 + Math.random()*6).toFixed(1); // 5-11

      const neuropatia = Math.random()<0.35; // ~35%
      const dap = Math.random()<0.2;
      const deformidade = Math.random()<0.22;
      const ulc_prev = Math.random()<0.12;
      const amp_prev = ulc_prev && Math.random()<0.2;

      const has = Math.random()<0.45;
      const tab = Math.random()<0.18;
      const alc = Math.random()<0.2;
      const atividade = Math.random()<0.6;

      // sensores
      const vel = +(0.6 + Math.random()*1.2).toFixed(2); // 0.6-1.8 m/s
      const passos = Math.floor(2000 + Math.random()*8000);
      const acc = +(0.2 + Math.random()*2.3).toFixed(2);
      const ori = +(Math.random()*12).toFixed(1);

      const temp_esq = +(30 + Math.random()*6).toFixed(1); // 30-36
      // se inflama, direita maior
      const temp_dir = +(temp_esq + (Math.random()*3 - 1)).toFixed(1);

      // pressao picos
      const ppp_esq = Math.floor(120 + Math.random()*160); // 120-280 kPa
      const ppp_dir = Math.floor(120 + Math.random()*160);

      state.paciente = {
        nome: nome,
        sobrenome:sobrenome,
        idade,sexo,imc,tempo,hba1c,
        neuropatia,dap,deformidade,ulc_prev,amp_prev,
        has,tab,alc,atividade,
        vel,passos,acc,ori,
        temp_esq,temp_dir,ppp_esq,ppp_dir
      };
      atualizarUI();
    }

    function reset(){state.paciente=null;atualizarUI();}

    function atualizarUI(){
      const p = state.paciente;
      document.getElementById('avatar').textContent = p ? (p.nome[0]+p.sobrenome[0]) : 'CP';
      document.getElementById('p_nome').textContent = p ? `Nome: ${p.nome} ${p.sobrenome}` : 'Nome: —';
      document.getElementById('p_demo').textContent = p ? `idade ${p.idade} • sexo ${p.sexo} • imc ${p.imc}` : 'idade — • sexo — • imc —';
      document.getElementById('p_clin').textContent = p ? `Tempo DM ${p.tempo} anos • HbA1c ${p.hba1c}%` : 'Tempo DM — • HbA1c —';

      // toggles area
      const etiologia = document.getElementById('etiologia'); etiologia.innerHTML='';
      const habitos = document.getElementById('habitos'); habitos.innerHTML='';
      const sensors = document.getElementById('sensors'); sensors.innerHTML='';

      if(p){
        // etiologia chips
        etiologia.appendChild(chip(`Neuropatia`, p.neuropatia));
        etiologia.appendChild(chip(`DAP`, p.dap));
        etiologia.appendChild(chip(`Deformidade`, p.deformidade));
        etiologia.appendChild(chip(`Úlcera prévia`, p.ulc_prev));
        etiologia.appendChild(chip(`Amputação prévia`, p.amp_prev));

        // habitos
        habitos.appendChild(chip(`HAS`, p.has));
        habitos.appendChild(chip(`Tabagismo`, p.tab));
        habitos.appendChild(chip(`Álcool`, p.alc));
        habitos.appendChild(chip(`Atividade física`, p.atividade));

        // sensores
        sensors.appendChild(chip(`Velocidade ${p.vel} m/s`, true));
        sensors.appendChild(chip(`Passos ${p.passos}`, true));
        sensors.appendChild(chip(`PPP E ${p.ppp_esq} kPa`, true));
        sensors.appendChild(chip(`PPP D ${p.ppp_dir} kPa`, true));
      }

      // preencher features
      const fillOr = (id,val)=>document.getElementById(id).textContent = val===undefined?'—':val;
      if(!p){
        ['f_idade','f_sexo','f_imc','f_tempo','f_hba1c','f_vel','f_passos','f_acc','f_ori','f_defo','f_has','f_tab','f_alc','f_atividade','f_ulc','f_amp'].forEach(i=>fillOr(i,'—'));
        ['temp-esq','temp-dir','temp-ass','ppp-esq','ppp-dir','p_score'].forEach(i=>document.getElementById(i)&&(document.getElementById(i).textContent='—'));
        document.getElementById('score').textContent='—';document.getElementById('score-label').textContent='—';document.getElementById('badge-neuro').textContent='Neuropatia: —';document.getElementById('badge-dap').textContent='DAP: —';
        document.getElementById('meter-fill').style.width='0%';document.getElementById('ppp-bar').style.width='0%';
        return;
      }

      fillOr('f_idade',p.idade);
      fillOr('f_sexo',p.sexo);
      fillOr('f_imc',p.imc);
      fillOr('f_tempo',p.tempo+' anos');
      fillOr('f_hba1c',p.hba1c+' %');
      fillOr('f_vel',p.vel+' m/s');
      fillOr('f_passos',p.passos);
      fillOr('f_acc',p.acc);
      fillOr('f_ori',p.ori+'°');
      fillOr('f_defo',p.deformidade? 'Sim':'Não');
      fillOr('f_has',p.has? 'Sim':'Não');
      fillOr('f_tab',p.tab? 'Sim':'Não');
      fillOr('f_alc',p.alc? 'Sim':'Não');
      fillOr('f_atividade',p.atividade? 'Sim':'Não');
      fillOr('f_ulc',p.ulc_prev? 'Sim':'Não');
      fillOr('f_amp',p.amp_prev? 'Sim':'Não');

      document.getElementById('temp-esq').textContent = p.temp_esq;document.getElementById('temp-dir').textContent = p.temp_dir;
      const tass = Math.abs((p.temp_esq - p.temp_dir)).toFixed(1);
      document.getElementById('temp-ass').textContent = tass + ' °C';
      document.getElementById('ppp-esq').textContent = p.ppp_esq;document.getElementById('ppp-dir').textContent = p.ppp_dir;

      // badges
      document.getElementById('badge-neuro').textContent = `Neuropatia: ${p.neuropatia? 'Sim':'Não'}`;
      document.getElementById('badge-dap').textContent = `DAP: ${p.dap? 'Sim':'Não'}`;

      // calcular risco
      const risco = calcularRisco(p);
      mostrarRisco(risco);

      // preencher ppp bar
      const pppMax = Math.max(p.ppp_esq,p.ppp_dir);
      const pppPct = Math.min(100, Math.round((pppMax/300)*100));
      document.getElementById('ppp-bar').style.width = pppPct + '%';
    }

    function chip(text,active){
      const d = document.createElement('div');d.className='chip';d.textContent=text; if(active) d.style.boxShadow='0 4px 18px rgba(0,0,0,0.4) inset';return d;
    }

    function calcularRisco(p){
      // normalização simples baseada em limites clínicos plausíveis
      const t_norm = norm(p.tempo,0,20);
      const h_norm = norm(p.hba1c,5,11);
      const neurop = p.neuropatia?1:0;
      const dap = p.dap?1:0;
      // PPP: usa maior pico
      const ppp = Math.max(p.ppp_esq,p.ppp_dir);
      const ppp_norm = norm(ppp,100,300);
      const pt_norm = 0; // placeholder para pressão integral
      const tass = Math.abs(p.temp_esq - p.temp_dir);
      const tass_norm = norm(tass,0,4); // 2.2 é cutoff
      const ulc_prev = p.ulc_prev?1:0;

      let score = 0;
      score += WEIGHTS.tempo_diabetes * t_norm;
      score += WEIGHTS.hba1c * h_norm;
      score += WEIGHTS.neuropatia * neurop;
      score += WEIGHTS.dap * dap;
      score += WEIGHTS.ppp * ppp_norm;
      score += WEIGHTS.ptt * pt_norm;
      score += WEIGHTS.temp_ass * tass_norm;
      score += WEIGHTS.historico_ulc * ulc_prev;

      // map to 0..100
      const scaled = Math.round(Math.min(100, Math.max(0, score*100)));
      return {raw:score,scaled,components:{t_norm,h_norm,neurop,dap,ppp_norm,tass_norm,ulc_prev}};
    }

    function mostrarRisco(r){
      const pct = r.scaled;
      document.getElementById('score').textContent = pct + '%';
      const label = pct<30? 'Baixo': (pct<60? 'Moderado':'Alto');
      document.getElementById('score-label').textContent = label;
      document.getElementById('meter-fill').style.width = pct + '%';
      // alterar cor da barra conforme pct
      const fill = document.getElementById('meter-fill');
      if(pct<30) fill.style.background = 'linear-gradient(90deg,#34d399,#60a5fa)';
      else if(pct<60) fill.style.background = 'linear-gradient(90deg,#f59e0b,#f97316)';
      else fill.style.background = 'linear-gradient(90deg,#f97316,#ef4444)';
    }

    document.getElementById('gerar').addEventListener('click', ()=>gerarPaciente());
    document.getElementById('reset').addEventListener('click', ()=>reset());

    // gerar um paciente inicial para demo
    gerarPaciente();
  </script>
</body>
</html>
